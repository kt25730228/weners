<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>WeNers ì‹¤ì‹œê°„ ì…ì°°</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: Arial;width:700px;margin:30px auto;}
.item {border-bottom:1px solid #ddd;padding:10px 0;}
.item h3 {margin:5px 0;}
</style>
</head>
<body>

<h2>ğŸ”· ìœ„ë„ˆìŠ¤ ì‹¤ì‹œê°„ ê²½ë§¤ (ë¡œê·¸ì¸)</h2>
<button onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
<button onclick="location.href='create_with_image_upload_auth.html'">ğŸ“Œ ìƒí’ˆ ë“±ë¡</button>
<hr>

<div id="list"></div>

<script>
// ğŸ“Œ Supabase client
const supabase = supabase.createClient(
 "https://YOUR-PROJECT.supabase.co",
 "YOUR-ANON-KEY"
);

// ë¡œê·¸ì¸ ì²´í¬
supabase.auth.getSession().then(({data})=>{
 if(!data.session) { alert("ë¡œê·¸ì¸ í•„ìš”"); location.href="auth_login.html"; }
 loadProducts();
 subscribeRealtime();   // ì‹¤ì‹œê°„ ì…ì°° ë°˜ì˜
});

// ğŸ”¥ ì‹¤ì‹œê°„ êµ¬ë…
function subscribeRealtime(){
 supabase.channel("realtime:bids")
 .on("postgres_changes",{event:"INSERT",schema:"public",table:"bids"}, loadProducts)
 .subscribe();
}

// ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸°
async function loadProducts(){
 const { data, error } = await supabase.from("products").select("*");
 if(error) return alert("ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");

 list.innerHTML="";
 data.forEach(p=>{
    list.innerHTML+=`
    <div class="item">
    <h3>${p.title}</h3>
    <p>${p.description||""}</p>
    <img src="${p.images}" width="200"><br>
    ğŸ’° ì‹œì‘ê°€: ${p.price_start}ì› <br>
    âš¡ ì¦‰ì‹œêµ¬ë§¤: ${p.price_end||"-"}<br><br>
    
    <input id="bid_${p.id}" type="number" placeholder="ì…ì°°ê°€ ì…ë ¥">
    <button onclick="bid('${p.id}')">ì…ì°°</button>
    </div>`;
 });
}

// ì…ì°° ìš”ì²­
async function bid(id){
 const price = Number(document.getElementById(`bid_${id}`).value);
 const user = (await supabase.auth.getUser()).data.user;

 await supabase.from("bids").insert({
    product_id:id,
    price:price,
    bidder:user.email
 });
 alert("ì…ì°° ì™„ë£Œ!");
}

// ë¡œê·¸ì•„ì›ƒ
function logout(){
 supabase.auth.signOut();
 alert("ë¡œê·¸ì•„ì›ƒë¨");
 location.href="auth_login.html";
}

</script>
</body>
</html>
